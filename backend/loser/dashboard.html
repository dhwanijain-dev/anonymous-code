<!DOCTYPE html>
<html>
<head>
<title>Water Pipeline Dashboard</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

<h2>ðŸŒŠ Pipeline Pressure Monitoring</h2>

<canvas id="chart" width="600" height="300"></canvas>

<h3>âš  Risk Nodes</h3>
<pre id="riskBox"></pre>

<script>

let chart;

async function fetchData(){

    const res = await fetch("/stream");
    const json = await res.json();

    if(json.data.length === 0) return;

    const latest = json.data[0];

    const labels = latest.nodes;
    const pressure = latest.pressure;

    if(!chart){

        const ctx = document.getElementById("chart");

        chart = new Chart(ctx, {
            type: "line",
            data: {
                labels: labels,
                datasets: [{
                    label: "Pressure Stream",
                    data: pressure
                }]
            }
        });

    } else {

        chart.data.datasets[0].data = pressure;
        chart.update();
    }

    document.getElementById("riskBox").innerText =
        JSON.stringify(latest.risk_nodes, null, 2);
}

setInterval(fetchData, 5000);
fetchData();

</script>

</body>
</html>